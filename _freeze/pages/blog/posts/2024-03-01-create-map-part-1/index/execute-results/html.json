{
  "hash": "e7d9df5756582b3449bc544aaec069ea",
  "result": {
    "markdown": "---\ntitle: Creating and visualizing maps of WASH data - Part 1\nsubtitle: Where are the pumps, waste skips, and humanitarian organizations?\ndescription: In this series of blog posts, you will learn how to create maps with your geospatial WASH data, and with the help of external geospatial data. \ncategories: \n  - r-tutorial\nauthor: \n  - name: \"Mian Zhong\"\n    affiliation: Global Health Engineering, ETH Zurich\n    affiliation_url: https://ghe.ethz.ch/\n    orcid_id: 0009-0009-4546-7214\ndate: \"2024-03-05\"\ndraft: false\nimage: \"thumbnail.jpg\"\nimage-alt: \"A map of water access points in Haiti\"\n---\n\n\n\n\n# Introduction\n\n## Why a map?\n\nWe love maps in WASH. Geo-location information is one of the most important type of data to collect and use. It helps to evaluate and monitor many aspects of WASH such as infrastructure planning or service access. To create and visualize such information on a map gives multiple benefits.\n\n-   Map is straight-forward. To understand how waste skips are distributed across a town, it is more intuitive to label the skips locations on a map instead of reading a long list of locations.\n-   Map is informative. To compare the concentration of humanitarian organizations globally, a thematic map can illustrate nicely by coloring the regions differently based on the concentration. To gain this insight from a table, however, needs multiple aggregation back and forth.\n-   Map is fun. To play around with a map is not a difficult job anymore. With a few lines in R, we can produce interactive WASH maps to communicate with a broad range of audience.\n\n## Useful R libraries\n\nTo create and visualize maps, we will need the help with the following R libraries to process geospatial data and plot the maps. We start with two useful libraries that will deliver a static map showing the locations:\n\n-   `sf`: a package that supports \"simple features\" (an encoding of spatial data).\n-   `tmap`: a package that can quickly plot thematic maps.\n\nThere are other libraries that are commonly used to add external geodata (e.g, `rnaturalearth`) and make interactive plots (e.g., `leaflet`). You will learn more about them in the next blog posts.\n\n## Useful openwashdata datasets\n\nTypically, a location point is described by its longitude and latitude. For this tutorial, we select two published datasets in openwashdata that collected geo-location data points.\n\n-   [`wasteskipsblantyre`](https://github.com/openwashdata/wasteskipsblantyre): Data on locations of the publicly accessible waste skips in Blantyre, Malawi collected in 2021.\n-   [`cbssuitabilityhaiti`](https://github.com/openwashdata/cbssuitabilityhaiti): Spatial data to support an analysis of suitability of container-based sanitation in flood prone areas of Haiti.\n\n# Plot map with collected data\n\n## Preparation\n\n1.  You have R and RStudio installed, or you can access Posit Cloud.\n2.  You have programmed a few lines in R programming, and know how to run commands in the console window.\n3.  You have installed and used R packages before.\n4.  You have familiarity with geospatial data and terms, such as longitude, latitude, and coordinate reference system.\n\n## Package Installation\n\nTo install the above-mentioned R packages, run the following command in the console.\n\n``` r\ninstall.packages(\"sf\", \"tmap\")      \n```\n\nTo install an openwashdata R data package, for example, the \\``` cbssuitabilityhaiti` `` package. Run the following command in the console. If you do not have the package `devtools` installed, you need to run the first line too.\n\n``` r\n# install.packages(\"devtools\")\ndevtools::install_github(\"openwashdata/cbssuitabilityhaiti\")\n```\n\nIf you want to install another openwashdata R data package, you need to change the `cbssuitabilityhaiti` to the corresponding package name.\n\n## Basic thematic map\n\nNow we have installed all needed R libraries. In the following sections, we will show two examples to create a quick view of the collected location data.\n\nFirst, load the libraries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tmap)\nlibrary(sf)\n```\n:::\n\n\n### 1. Example: Waste skips in Blantyre, Malawi\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(wasteskipsblantyre) # Load the openwashdata R package\n```\n:::\n\n\nYou could get a taste of the dataset by looking at the first a few rows of the data,\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(wasteskipsblantyre)\n#>                   name     long       lat capacity_l\n#> 1      Ndirande ground 35.05063 -15.77515       7000\n#> 2 Chimwankhunda mosque 35.01484 -15.82705       7000\n#> 3         Naizi market 35.08819 -15.84962       7000\n#> 4    Machinjiri market 35.08105 -15.74466       7000\n#> 5   South Lunzu market 35.05611 -15.73089       7000\n#> 6         Khama market 35.07455 -15.76771       7000\n```\n:::\n\n\nEach row in the dataset `wasteskipsblantyre` is a geolocation of a waste skip. We focus on the columns `long` and `lat` to plot these skips. First, we need to convert the location columns into a format that is designed for geospatial data. To achieve this, we use the function `st_as_sf` from the `sf` package as the following:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_wsb <- st_as_sf(wasteskipsblantyre, coords = c('long', 'lat'), crs = 4326)\n```\n:::\n\n\nWe specify two parameters here, `coords` and `crs`. Because we are plotting points on the map, we need to tell what columns from our data holding these points (i.e. coordinates). In our case, we have seen that the column `long` and `lat` provide the longitude and latitude coordinates. Then, we need to give which coordinate reference system is used.\n\nNow we can use this formatted geodata to plot a map showing waste skip locations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_wsb |>\n  tm_shape() + # a necessary step to tell a map will be created\n  tm_dots() + # plot the locations\n  tm_graticules() # create coordinate grid lines\n```\n\n::: {.cell-output-display}\n![Locations of waste skips in this dataset](index_files/figure-html/fig-waste-skips-simple-1.png){#fig-waste-skips-simple width=672}\n:::\n:::\n\n\nIf you are interested in knowing more about the dataset, check out this amazing tutorial: <https://openwashdata.github.io/wasteskipsblantyre/articles/examples.html>\n\n### 2. Example: Water access in Cap Ha誰tien, Haiti\n\nYou might notice that the first example only shows the locations rather than locations on top of a base map, such as the city map. This is because the data does not include the geospatial information about the city, for example, the boundaries between districts. You will learn how to combine with external data to resolve this in the next post. Now, what if we also collected data to plot the base map?  \n\nIn this example, the dataset contains both water access points (in `mwater`) as well as the base map geometry (in `okap`) for the municipality of Cap Ha誰tien. As before, we can plot the water access points like:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cbssuitabilityhaiti)\n\nmwater|> tm_shape() +\n    tm_dots() +\n    tm_graticules()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\nWe can plot the base map from `okap` as the following:\n\n::: {.cell}\n\n```{.r .cell-code}\nokap |> tm_shape() +\n    tm_borders() +\n    tm_fill(alpha = 0.6) +\n    tm_graticules()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\nWe can see that `okap` data contains more than Cap Ha誰tien data. Therefore, we need to filter the data `okap` on `cte` variable (Name of the communes) to keep data only relevant to Cap Ha誰tien before combining the two maps. \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ncaphaitien <- filter(okap, cte == \"ctecaphaitien\")\n\ncaphaitien |> tm_shape() +\n    tm_borders() +\n    tm_fill(alpha = 0.6) +\n    tm_graticules()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\nNow, let's see what happens if we stack these two map layers together.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create base map layer\ntm_shape(caphaitien) +\n    tm_borders() +\n    tm_fill(alpha = 0.6)  +\n  # create second map layer: locations of the water points\n    tm_shape(mwater) +\n    tm_dots() +\n    tm_graticules()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\nThis is still a little problematic. Many water points are plotted outside of the base map.The base map may not contain enough boundary information to cover all areas where certain water points were recorded. One way is to join the two datasets to include water points within the base map area. We might also want to remove the coordinate gridlines for better visuals.\n\nWe join join the base map data to `mwater` data and remove observations that do not have a unique identifying number neighborhood unit. Note: joining map data takes order into account, `st_join(caphaitien, mwater)` would render different results. \n\n::: {.cell}\n\n```{.r .cell-code}\n# Join the data and filter\ncaphaitien_join <- st_join(mwater, caphaitien) |> drop_na(neighborho)\n\n# Create base map layer\ntm_shape(caphaitien) +\n    tm_borders() +\n    tm_fill(alpha = 0.6)  +\n  # create second map layer: locations of the water points\n    tm_shape(caphaitien_join) +\n    tm_dots()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nFinally, we can visualize other features about the water points by adding parameters in `tm_dots()`. For example, we can color different types of the water points as follows:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create base map layer\ntm_shape(caphaitien) +\n    tm_borders() +\n    tm_fill(alpha = 0.6)  +\n  # create second map layer: locations of the water points\n    tm_shape(caphaitien_join) +\n    tm_dots(col = \"type\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nIf you are interested in knowing more about this dataset, we have a wonderful detailed tutorial: <https://openwashdata.github.io/cbssuitabilityhaiti/articles/examples.html>\n\n## What's next?\n\n-   [Plot maps with external geospatial data](https://openwashdata.org/pages/blog/posts/2024-03-01-create-map-part-2/)\n-   Make an interactive map\n\nReferences:\n\n\\[1\\] [wasteskipsblantyre Example Tutorial](https://openwashdata.github.io/wasteskipsblantyre/articles/examples.html)\n\n\\[2\\] [cbssuitabilityhaiti Example Tutorial](https://openwashdata.github.io/cbssuitabilityhaiti/articles/examples.html)\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}